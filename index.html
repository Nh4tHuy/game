<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phần Mềm Bản Quyền</title>
    <style>
        :root { --primary-color: #2563eb; --error-color: #dc2626; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f3f4f6; }
        
        /* Màn hình khóa */
        #lock-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: white; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 9999; 
        }
        
        .card {
            background: white; padding: 2rem; border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%;
        }

        .id-box { 
            background: #e5e7eb; padding: 10px; border-radius: 6px; 
            font-weight: bold; font-size: 1.2rem; letter-spacing: 2px;
            margin: 1rem 0; display: flex; justify-content: center; align-items: center; gap: 10px;
        }

        input[type="text"] {
            width: 100%; padding: 12px; margin-bottom: 1rem;
            border: 1px solid #d1d5db; border-radius: 6px; box-sizing: border-box;
        }

        button {
            width: 100%; padding: 12px; border: none; border-radius: 6px;
            background: var(--primary-color); color: white; cursor: pointer; font-weight: bold;
        }

        button:hover { opacity: 0.9; }
        
        .copy-btn { background: #6b7280; width: auto; padding: 5px 10px; font-size: 0.8rem; }

        #msg { color: var(--error-color); margin-top: 10px; font-size: 0.9rem; }
        .hidden { display: none !important; }

        /* Nội dung chính */
        #main-content { padding: 2rem; text-align: center; }
    </style>
</head>
<body>

    <div id="lock-screen">
        <div class="card">
            <p>Vui lòng gửi mã ID bên dưới cho quản trị viên để nhận Key.</p>
            
            <div class="id-box">
                <span id="display-id">......</span>
                <button class="copy-btn" onclick="copyId()">Copy</button>
            </div>
            <input type="text" id="key-input" placeholder="Nhập mã Key (VD: Wiky123)">
          <button class="copy-btn" onclick="checkLicense()">Kích Hoạt Ngay</button>
            <p id="msg"></p>
        </div>
    </div>

    <div id="main-content" class="hidden">
      <div class="flex-1">
                    <iframe src="https://prompt-game-ung-dung-giao-duc.netlify.app/" class="w-full h-full border-0"></iframe>
                </div>
    </div>

    <script>
        // THAY LINK WEB APP CỦA BẠN VÀO ĐÂY
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzz3sX1jrj4xUzqBE-oT29Aa3ScUDwEpyFSNS3LVWFs9fVvxtr479ZAMD2aKDZc7h5Qtw/exec";

        // 1. Tạo hoặc lấy ID máy (6 ký tự in hoa)
        function getDeviceId() {
            let id = localStorage.getItem('device_id');
            if (!id) {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                id = '';
                for (let i = 0; i < 6; i++) {
                    id += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                localStorage.setItem('device_id', id);
            }
            return id;
        }

        const deviceId = getDeviceId();
        document.getElementById('display-id').innerText = deviceId;

        // 2. Kiểm tra trạng thái đã kích hoạt chưa khi vừa mở trang
        window.onload = function() {
            if (localStorage.getItem('is_activated') === 'true') {
                showContent();
            }
        };

        // 3. Hàm copy ID
        function copyId() {
            navigator.clipboard.writeText(deviceId);
            alert("Đã copy ID: " + deviceId);
        }

        // 4. Hàm xác thực Key với Google Sheet
        async function checkLicense() {
            const key = document.getElementById('key-input').value.trim();
            const msg = document.getElementById('msg');
            
            if (!key) {
                msg.innerText = "Vui lòng nhập Key!";
                return;
            }

            msg.style.color = "blue";
            msg.innerText = "Đang xác thực...";

            try {
                // Gọi tới Google Apps Script
                const response = await fetch(`${SCRIPT_URL}?id=${deviceId}&key=${key}`);
                const result = await response.text();

                if (result === "valid") {
                    localStorage.setItem('is_activated', 'true');
                    showContent();
                } else {
                    msg.style.color = "red";
                    msg.innerText = "Key không hợp lệ. Vui lòng liên hệ Admin để nhận !";
                }
            } catch (error) {
                msg.style.color = "red";
                msg.innerText = "Lỗi kết nối. Vui lòng kiểm tra Internet!";
            }
        }

        // 5. Hàm hiển thị nội dung chính
        function showContent() {
            document.getElementById('lock-screen').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        }
    </script>
</body>
</html>









